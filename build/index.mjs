import {useRef,useEffect}from'react';import U from'fast-deep-equal';var l=class e{constructor(){this.traces=[];}static empty(){return new e}add(t){let r=new e;return r.traces=[...this.traces,t],r}*[Symbol.iterator](){for(let t of this.traces)yield t;}};var p=class e{constructor(t,r){this.message=t,this.time=r;}static from(t,r){return new e(t,r)}read(){return this.message}at(){return this.time}};var h=Symbol("JsMonadSomeSymbol"),T,f=class e{constructor(t){this[T]=true;this.value=t;}static[(T=h,Symbol.hasInstance)](t){return y(t)}static of(t){return new e(t)}bind(t){return t(this.value)}unwrap(){return this.value}map(t){let r=t(this.value);return e.of(r)}};function y(e){return e&&e[h]===true}var d=Symbol("JsMonadNoneSymbol"),v,x=class e{constructor(){this[v]=true;}static[(v=d,Symbol.hasInstance)](t){return C(t)}static of(){return new e}bind(t){return this}unwrap(){throw new Error("Value of None cannot be unwrapped")}map(t){return this}};function C(e){return e&&e[d]===true}var c=class e{constructor(){this.contexts={};}static empty(){return new e}get(t){return this.contexts[t]?f.of(this.contexts[t]):x.of()}add(t,r){let o=new e;return o.contexts={...this.contexts},o.contexts[t]=r,o}remove(t){let r=new e;return r.contexts={...this.contexts},delete r.contexts[t],r}*[Symbol.iterator](){for(let t in this.contexts)yield this.contexts[t];}};var g=Symbol("JsMonadFailureSymbol"),R,a=class e{constructor(t,r,o,n,i){this[R]=true;this.message=t,this.name="Failure",this.code=r,this.traces=o,this.contexts=n,this.previous=i;}static[(R=g,Symbol.hasInstance)](t){return w(t)}static dueTo(t,r,o,n,i,m){return i=i??l.empty(),n?i.add(n):i.add(p.from(t,Date.now())),m=m??c.empty(),new e(t,r,i,m,o||null)}bind(t){return this}map(t){return this}lift(t){return this}unwrap(){throw new Error("Value of Failure can not be unwrapped")}getTraces(){return this.traces}withTrace(t){return this.traces.add(t),this}withContext(t,r){return this.contexts.add(t,r),this}getContext(t){return this.contexts.get(t)}getContexts(){return this.contexts}clearContext(t){return this.contexts.remove(t),this}};function w(e){return e&&e[g]===true}var S=Symbol("JsMonadSuccessSymbol"),b,s=class e{constructor(t,r,o){this[b]=true;this.value=t,this.traces=r,this.contexts=o;}static[(b=S,Symbol.hasInstance)](t){return A(t)}static of(t,r,o){return new e(t,r??l.empty(),o??c.empty())}bind(t){return t(this.value)}lift(t){return new e(t,this.traces,this.contexts)}map(t){return new e(t(this.value),this.traces,this.contexts)}unwrap(){return this.value}getTraces(){return this.traces}withTrace(t){return this.traces.add(t),this}withContext(t,r){return this.contexts.add(t,r),this}getContext(t){return this.contexts.get(t)}getContexts(){return this.contexts}clearContext(t){return this.contexts.remove(t),this}};function A(e){return e&&e[S]===true}var E=Symbol("JsMonadAwaitingSymbol"),O;O=E;var u=class{constructor(){this[O]=true;}};function N(e){return e&&e[E]===true}function J(e,{onSuccess:t,onFailure:r}){let o=useRef(new u);useEffect(()=>{let n=o.current,i=n instanceof u&&(e instanceof s||e instanceof a)||n instanceof s&&e instanceof a||n instanceof a&&e instanceof s,m=e instanceof s&&n instanceof s&&!U(n.unwrap(),e.unwrap());(i||m)&&(e instanceof s&&t&&t(e.unwrap()),e instanceof a&&r&&r(e.unwrap())),o.current=e;},[e,t,r]);}export{u as Awaiting,c as ContextCollection,a as Failure,x as None,f as Some,s as Success,l as TraceCollection,p as TraceCommon,N as isAwaiting,w as isFailure,C as isNone,y as isSome,A as isSuccess,J as useEffectAsyncResult};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb25hZC90cmFjZS90cmFjZS1jb2xsZWN0aW9uLnRzIiwiLi4vc3JjL21vbmFkL3RyYWNlL3RyYWNlLWNvbW1vbi50cyIsIi4uL3NyYy9tb25hZC9tb25hZHMvb3B0aW9uYWwvc29tZS50cyIsIi4uL3NyYy9tb25hZC9tb25hZHMvb3B0aW9uYWwvbm9uZS50cyIsIi4uL3NyYy9tb25hZC9jb250ZXh0L2NvbnRleHQtY29sbGVjdGlvbi50cyIsIi4uL3NyYy9tb25hZC9tb25hZHMvZWl0aGVyL2ZhaWx1cmUudHMiLCIuLi9zcmMvbW9uYWQvbW9uYWRzL2VpdGhlci9zdWNjZXNzLnRzIiwiLi4vc3JjL21vbmFkL2F3YWl0aW5nLnRzIiwiLi4vc3JjL21vbmFkL2hvb2tzL3VzZS1lZmZlY3QtYXN5bmMtcmVzdWx0LnRzeCJdLCJuYW1lcyI6WyJUcmFjZUNvbGxlY3Rpb24iLCJfVHJhY2VDb2xsZWN0aW9uIiwidHJhY2UiLCJuZXdDb2xsZWN0aW9uIiwiVHJhY2VDb21tb24iLCJfVHJhY2VDb21tb24iLCJtZXNzYWdlIiwidGltZSIsIlNvbWVTeW1ib2wiLCJfYSIsIlNvbWUiLCJfU29tZSIsInZhbHVlIiwib2JqIiwiaXNTb21lIiwiZm4iLCJuZXdWYWx1ZSIsIk5vbmVTeW1ib2wiLCJOb25lIiwiX05vbmUiLCJpc05vbmUiLCJDb250ZXh0Q29sbGVjdGlvbiIsIl9Db250ZXh0Q29sbGVjdGlvbiIsImtleSIsImNvbnRleHQiLCJGYWlsdXJlU3ltYm9sIiwiRmFpbHVyZSIsIl9GYWlsdXJlIiwiY29kZSIsInRyYWNlcyIsImNvbnRleHRzIiwicHJldmlvdXMiLCJpc0ZhaWx1cmUiLCJTdWNjZXNzU3ltYm9sIiwiU3VjY2VzcyIsIl9TdWNjZXNzIiwiaXNTdWNjZXNzIiwiQXdhaXRpbmdTeW1ib2wiLCJBd2FpdGluZyIsImlzQXdhaXRpbmciLCJ1c2VFZmZlY3RBc3luY1Jlc3VsdCIsInJlc3VsdCIsIm9uU3VjY2VzcyIsIm9uRmFpbHVyZSIsInByZXZpb3VzUmVmIiwidXNlUmVmIiwidXNlRWZmZWN0IiwiaGFzU3RhdHVzQ2hhbmdlZCIsImhhc1ZhbHVlQ2hhbmdlZCIsImlzRXF1YWwiXSwibWFwcGluZ3MiOiJvRUFJYUEsSUFBQUEsQ0FBQUEsQ0FBTixNQUFNQyxDQUFrQyxDQUdyQyxhQUFjLENBRnRCLElBQUEsQ0FBVSxPQUFrQixHQUVMLENBRXZCLE9BQWMsS0FBQSxFQUF5QixDQUNyQyxPQUFPLElBQUlBLENBQ2IsQ0FFTyxHQUFBLENBQUlDLENBQStCLENBQUEsQ0FDeEMsSUFBTUMsQ0FBQUEsQ0FBZ0IsSUFBSUYsQ0FDMUIsQ0FBQSxPQUFBRSxFQUFjLE1BQVMsQ0FBQSxDQUFDLEdBQUcsSUFBSyxDQUFBLE1BQUEsQ0FBUUQsQ0FBSyxDQUFBLENBQ3RDQyxDQUNULENBRUEsRUFBUyxNQUFPLENBQUEsUUFBUSxHQUFxQixDQUMzQyxJQUFBLElBQVdELEtBQVMsSUFBSyxDQUFBLE1BQUEsQ0FDdkIsTUFBTUEsRUFFVixDQUNGLE1DckJhRSxDQUFOLENBQUEsTUFBTUMsQ0FBNkIsQ0FJaEMsV0FBQSxDQUFZQyxFQUFpQkMsQ0FBYyxDQUFBLENBQ2pELEtBQUssT0FBVUQsQ0FBQUEsQ0FBQUEsQ0FDZixLQUFLLElBQU9DLENBQUFBLEVBQ2QsQ0FFQSxPQUFjLElBQUEsQ0FBS0QsRUFBaUJDLENBQTJCLENBQUEsQ0FDN0QsT0FBTyxJQUFJRixDQUFZQyxDQUFBQSxDQUFBQSxDQUFTQyxDQUFJLENBQ3RDLENBRU8sTUFBZSxDQUNwQixPQUFPLEtBQUssT0FDZCxDQUVPLEVBQWEsRUFBQSxDQUNsQixPQUFPLElBQUEsQ0FBSyxJQUNkLENBQ0YsTUNuQk1DLENBQWEsQ0FBQSxNQUFBLENBQU8sbUJBQW1CLENBSjdDQyxDQUFBQSxDQUFBQSxDQU1hQyxDQUFOLENBQUEsTUFBTUMsQ0FBK0IsQ0FTbEMsWUFBWUMsQ0FBVSxDQUFBLENBTjlCLEtBQUNILENBQWMsQ0FBQSxDQUFBLElBQUEsQ0FPYixLQUFLLEtBQVFHLENBQUFBLEVBQ2YsQ0FOQSxRQUZD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QUFPLEVBQUMsRUFFdkJBLENBQWtCZixZQUFBQSxDQUFBQSxFQUFXaUIsQ0FDL0JBLEVBQUFBLENBQUFBLENBQVVGLENBQU8sQ0FBQSxNQUFBLEVBQVEsQ0FJN0JHLENBQUFBLENBQUFBLENBQUFBLENBQVksUUFBVUgsRUFDeEIsQ0FBQSxDQUFHLENBQUNBLENBQVFDLENBQUFBLENBQUFBLENBQVdDLENBQVMsQ0FBQyxFQUNuQyIsImZpbGUiOiJpbmRleC5tanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbXBsZW1lbnQgdGhlIFRyYWNlQ29sbGVjdGlvbiBjbGFzc1xuaW1wb3J0IHsgVHJhY2VzIH0gZnJvbSBcIkAvbW9uYWQvdHJhY2UvdHJhY2VzXCI7XG5pbXBvcnQgeyBUcmFjZSB9IGZyb20gXCJAL21vbmFkL3RyYWNlL3RyYWNlXCI7XG5cbmV4cG9ydCBjbGFzcyBUcmFjZUNvbGxlY3Rpb24gaW1wbGVtZW50cyBUcmFjZXMge1xuICBwcm90ZWN0ZWQgdHJhY2VzOiBUcmFjZVtdID0gW107XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgcHVibGljIHN0YXRpYyBlbXB0eSgpOiBUcmFjZUNvbGxlY3Rpb24ge1xuICAgIHJldHVybiBuZXcgVHJhY2VDb2xsZWN0aW9uKCk7XG4gIH1cblxuICBwdWJsaWMgYWRkKHRyYWNlOiBUcmFjZSk6IFRyYWNlQ29sbGVjdGlvbiB7XG4gICAgY29uc3QgbmV3Q29sbGVjdGlvbiA9IG5ldyBUcmFjZUNvbGxlY3Rpb24oKTtcbiAgICBuZXdDb2xsZWN0aW9uLnRyYWNlcyA9IFsuLi50aGlzLnRyYWNlcywgdHJhY2VdO1xuICAgIHJldHVybiBuZXdDb2xsZWN0aW9uO1xuICB9XG5cbiAgcHVibGljICpbU3ltYm9sLml0ZXJhdG9yXSgpOiBJdGVyYXRvcjxUcmFjZT4ge1xuICAgIGZvciAoY29uc3QgdHJhY2Ugb2YgdGhpcy50cmFjZXMpIHtcbiAgICAgIHlpZWxkIHRyYWNlO1xuICAgIH1cbiAgfVxufVxuIiwiLy8gSW1wbGVtZW50IHRoZSBUcmFjZUNvbW1vbiBjbGFzc1xuaW1wb3J0IHsgVHJhY2UgfSBmcm9tIFwiQC9tb25hZC90cmFjZS90cmFjZVwiO1xuXG5leHBvcnQgY2xhc3MgVHJhY2VDb21tb24gaW1wbGVtZW50cyBUcmFjZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWVzc2FnZTogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IHRpbWU6IG51bWJlcjtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKG1lc3NhZ2U6IHN0cmluZywgdGltZTogbnVtYmVyKSB7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTtcbiAgICB0aGlzLnRpbWUgPSB0aW1lO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBmcm9tKG1lc3NhZ2U6IHN0cmluZywgdGltZTogbnVtYmVyKTogVHJhY2VDb21tb24ge1xuICAgIHJldHVybiBuZXcgVHJhY2VDb21tb24obWVzc2FnZSwgdGltZSk7XG4gIH1cblxuICBwdWJsaWMgcmVhZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLm1lc3NhZ2U7XG4gIH1cblxuICBwdWJsaWMgYXQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy50aW1lO1xuICB9XG59XG4iLCJpbXBvcnQgeyBPcHRpb25hbCB9IGZyb20gXCJAL21vbmFkL29wdGlvbmFsXCI7XG5pbXBvcnQgeyBBc3luY09wdGlvbmFsUmVzdWx0LCBPcHRpb25hbFJlc3VsdCB9IGZyb20gXCJAL21vbmFkL3Jlc3VsdFwiO1xuaW1wb3J0IHsgaXNOb25lLCBOb25lIH0gZnJvbSBcIkAvbW9uYWQvbW9uYWRzL29wdGlvbmFsL25vbmVcIjtcblxuY29uc3QgU29tZVN5bWJvbCA9IFN5bWJvbChcIkpzTW9uYWRTb21lU3ltYm9sXCIpO1xuXG5leHBvcnQgY2xhc3MgU29tZTxUPiBpbXBsZW1lbnRzIE9wdGlvbmFsPFQ+IHtcbiAgcHJpdmF0ZSByZWFkb25seSB2YWx1ZTogVDtcblxuICBbU29tZVN5bWJvbF0gPSB0cnVlO1xuXG4gIHN0YXRpYyBbU3ltYm9sLmhhc0luc3RhbmNlXShvYmo6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBpc1NvbWUob2JqKTtcbiAgfVxuXG4gIHByaXZhdGUgY29uc3RydWN0b3IodmFsdWU6IFQpIHtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gIH1cblxuICBzdGF0aWMgb2Y8VD4odmFsdWU6IFQpOiBTb21lPFQ+IHtcbiAgICByZXR1cm4gbmV3IFNvbWUodmFsdWUpO1xuICB9XG5cbiAgYmluZDxVPihmbjogKHZhbHVlOiBUKSA9PiBPcHRpb25hbDxVPik6IE9wdGlvbmFsPFU+IHtcbiAgICByZXR1cm4gZm4odGhpcy52YWx1ZSk7XG4gIH1cblxuICB1bndyYXAoKTogVCB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH1cblxuICBtYXA8VT4oZm46ICh2YWx1ZTogVCkgPT4gVSk6IE9wdGlvbmFsPFU+IHtcbiAgICBjb25zdCBuZXdWYWx1ZSA9IGZuKHRoaXMudmFsdWUpO1xuICAgIHJldHVybiBTb21lLm9mKG5ld1ZhbHVlKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTb21lPFQ+KFxuICBvYmo6IE9wdGlvbmFsUmVzdWx0PGFueT4gfCBBc3luY09wdGlvbmFsUmVzdWx0PGFueT4sXG4pOiBvYmogaXMgU29tZTxUPiB7XG4gIHJldHVybiBvYmogJiYgKG9iaiBhcyBTb21lPFQ+KVtTb21lU3ltYm9sXSA9PT0gdHJ1ZTtcbn1cbiIsIi8vIERlZmluZSB0aGUgTm9uZSBjbGFzcyBpbXBsZW1lbnRpbmcgdGhlIE9wdGlvbmFsIGludGVyZmFjZVxuaW1wb3J0IHsgT3B0aW9uYWwgfSBmcm9tIFwiQC9tb25hZC9vcHRpb25hbFwiO1xuaW1wb3J0IHsgQXN5bmNPcHRpb25hbFJlc3VsdCwgT3B0aW9uYWxSZXN1bHQgfSBmcm9tIFwiQC9tb25hZC9yZXN1bHRcIjtcbmltcG9ydCB7IGlzRmFpbHVyZSB9IGZyb20gXCJAL21vbmFkL21vbmFkcy9laXRoZXIvZmFpbHVyZVwiO1xuXG5jb25zdCBOb25lU3ltYm9sID0gU3ltYm9sKFwiSnNNb25hZE5vbmVTeW1ib2xcIik7XG5cbmV4cG9ydCBjbGFzcyBOb25lIGltcGxlbWVudHMgT3B0aW9uYWw8bmV2ZXI+IHtcbiAgW05vbmVTeW1ib2xdID0gdHJ1ZTtcblxuICBzdGF0aWMgW1N5bWJvbC5oYXNJbnN0YW5jZV0ob2JqOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gaXNOb25lKG9iaik7XG4gIH1cblxuICBzdGF0aWMgb2YoKTogTm9uZSB7XG4gICAgcmV0dXJuIG5ldyBOb25lKCk7XG4gIH1cblxuICBiaW5kKGZuOiAodmFsdWU6IG5ldmVyKSA9PiBPcHRpb25hbDxuZXZlcj4pOiBOb25lIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHVud3JhcCgpOiBuZXZlciB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgb2YgTm9uZSBjYW5ub3QgYmUgdW53cmFwcGVkXCIpO1xuICB9XG5cbiAgbWFwPFU+KGZuOiAodmFsdWU6IG5ldmVyKSA9PiBVKTogTm9uZSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzTm9uZTxUPihcbiAgb2JqOiBPcHRpb25hbFJlc3VsdDxUPiB8IEFzeW5jT3B0aW9uYWxSZXN1bHQ8VD4sXG4pOiBvYmogaXMgTm9uZSB7XG4gIHJldHVybiBvYmogJiYgKG9iaiBhcyBOb25lKVtOb25lU3ltYm9sXSA9PT0gdHJ1ZTtcbn1cbiIsImltcG9ydCB7IENvbnRleHRzIH0gZnJvbSBcIkAvbW9uYWQvY29udGV4dC9jb250ZXh0c1wiO1xuaW1wb3J0IHsgQ29udGV4dCB9IGZyb20gXCJAL21vbmFkL2NvbnRleHQvY29udGV4dFwiO1xuaW1wb3J0IHsgT3B0aW9uYWxSZXN1bHQgfSBmcm9tIFwiQC9tb25hZC9yZXN1bHRcIjtcbmltcG9ydCB7IFNvbWUgfSBmcm9tIFwiQC9tb25hZC9tb25hZHMvb3B0aW9uYWwvc29tZVwiO1xuaW1wb3J0IHsgTm9uZSB9IGZyb20gXCJAL21vbmFkL21vbmFkcy9vcHRpb25hbC9ub25lXCI7XG5cbmV4cG9ydCBjbGFzcyBDb250ZXh0Q29sbGVjdGlvbiBpbXBsZW1lbnRzIENvbnRleHRzIHtcbiAgcHJpdmF0ZSBjb250ZXh0czogeyBba2V5OiBzdHJpbmddOiBDb250ZXh0IH0gPSB7fTtcblxuICBzdGF0aWMgZW1wdHkoKTogQ29udGV4dENvbGxlY3Rpb24ge1xuICAgIHJldHVybiBuZXcgQ29udGV4dENvbGxlY3Rpb24oKTtcbiAgfVxuXG4gIGdldChrZXk6IHN0cmluZyk6IE9wdGlvbmFsUmVzdWx0PENvbnRleHQ+IHtcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0c1trZXldID8gU29tZS5vZih0aGlzLmNvbnRleHRzW2tleV0pIDogTm9uZS5vZigpO1xuICB9XG5cbiAgYWRkKGtleTogc3RyaW5nLCBjb250ZXh0OiBDb250ZXh0KTogQ29udGV4dENvbGxlY3Rpb24ge1xuICAgIGNvbnN0IG5ld0NvbGxlY3Rpb24gPSBuZXcgQ29udGV4dENvbGxlY3Rpb24oKTtcbiAgICBuZXdDb2xsZWN0aW9uLmNvbnRleHRzID0geyAuLi50aGlzLmNvbnRleHRzIH07XG4gICAgbmV3Q29sbGVjdGlvbi5jb250ZXh0c1trZXldID0gY29udGV4dDtcbiAgICByZXR1cm4gbmV3Q29sbGVjdGlvbjtcbiAgfVxuXG4gIHJlbW92ZShrZXk6IHN0cmluZyk6IENvbnRleHRDb2xsZWN0aW9uIHtcbiAgICBjb25zdCBuZXdDb2xsZWN0aW9uID0gbmV3IENvbnRleHRDb2xsZWN0aW9uKCk7XG4gICAgbmV3Q29sbGVjdGlvbi5jb250ZXh0cyA9IHsgLi4udGhpcy5jb250ZXh0cyB9O1xuICAgIGRlbGV0ZSBuZXdDb2xsZWN0aW9uLmNvbnRleHRzW2tleV07XG4gICAgcmV0dXJuIG5ld0NvbGxlY3Rpb247XG4gIH1cblxuICAqW1N5bWJvbC5pdGVyYXRvcl0oKTogSXRlcmF0b3I8Q29udGV4dD4ge1xuICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMuY29udGV4dHMpIHtcbiAgICAgIHlpZWxkIHRoaXMuY29udGV4dHNba2V5XTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7IEVpdGhlciB9IGZyb20gXCJAL21vbmFkL2VpdGhlclwiO1xuaW1wb3J0IHsgQXN5bmNSZXN1bHQsIE9wdGlvbmFsUmVzdWx0LCBSZXN1bHQgfSBmcm9tIFwiQC9tb25hZC9yZXN1bHRcIjtcbmltcG9ydCB7IFRyYWNlcyB9IGZyb20gXCJAL21vbmFkL3RyYWNlL3RyYWNlc1wiO1xuaW1wb3J0IHsgVHJhY2UgfSBmcm9tIFwiQC9tb25hZC90cmFjZS90cmFjZVwiO1xuaW1wb3J0IHsgQ29udGV4dHMgfSBmcm9tIFwiQC9tb25hZC9jb250ZXh0L2NvbnRleHRzXCI7XG5pbXBvcnQgeyBDb250ZXh0IH0gZnJvbSBcIkAvbW9uYWQvY29udGV4dC9jb250ZXh0XCI7XG5pbXBvcnQgeyBUcmFjZUNvbGxlY3Rpb24gfSBmcm9tIFwiQC9tb25hZC90cmFjZS90cmFjZS1jb2xsZWN0aW9uXCI7XG5pbXBvcnQgeyBUcmFjZUNvbW1vbiB9IGZyb20gXCJAL21vbmFkL3RyYWNlL3RyYWNlLWNvbW1vblwiO1xuaW1wb3J0IHsgQ29udGV4dENvbGxlY3Rpb24gfSBmcm9tIFwiQC9tb25hZC9jb250ZXh0L2NvbnRleHQtY29sbGVjdGlvblwiO1xuaW1wb3J0IHsgaXNTdWNjZXNzIH0gZnJvbSBcIkAvbW9uYWQvbW9uYWRzL2VpdGhlci9zdWNjZXNzXCI7XG5cbmNvbnN0IEZhaWx1cmVTeW1ib2wgPSBTeW1ib2woXCJKc01vbmFkRmFpbHVyZVN5bWJvbFwiKTtcblxuZXhwb3J0IGNsYXNzIEZhaWx1cmUgaW1wbGVtZW50cyBFaXRoZXI8bmV2ZXI+LCBFcnJvciB7XG4gIHByaXZhdGUgcmVhZG9ubHkgdHJhY2VzOiBUcmFjZXM7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dHM6IENvbnRleHRzO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGNvZGU6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBwcmV2aW91czogRXJyb3IgfCBudWxsO1xuXG4gIFtGYWlsdXJlU3ltYm9sXSA9IHRydWU7XG5cbiAgc3RhdGljIFtTeW1ib2wuaGFzSW5zdGFuY2VdKG9iajogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGlzRmFpbHVyZShvYmopO1xuICB9XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcihcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgY29kZTogc3RyaW5nLFxuICAgIHRyYWNlczogVHJhY2VzLFxuICAgIGNvbnRleHRzOiBDb250ZXh0cyxcbiAgICBwcmV2aW91czogRXJyb3IgfCBudWxsLFxuICApIHtcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICAgIHRoaXMubmFtZSA9IFwiRmFpbHVyZVwiO1xuICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgdGhpcy50cmFjZXMgPSB0cmFjZXM7XG4gICAgdGhpcy5jb250ZXh0cyA9IGNvbnRleHRzO1xuICAgIHRoaXMucHJldmlvdXMgPSBwcmV2aW91cztcbiAgfVxuXG4gIHN0YXRpYyBkdWVUbyhcbiAgICBtZXNzYWdlOiBzdHJpbmcsXG4gICAgY29kZTogc3RyaW5nLFxuICAgIHByZXZpb3VzPzogRXJyb3IgfCBudWxsLFxuICAgIHRyYWNlPzogVHJhY2UgfCBudWxsLFxuICAgIHRyYWNlcz86IFRyYWNlcyB8IG51bGwsXG4gICAgY29udGV4dHM/OiBDb250ZXh0cyB8IG51bGwsXG4gICk6IEZhaWx1cmUge1xuICAgIC8vIEFkZCBGYWlsdXJlIHRyYWNlcyBhcyBsYXN0IGl0ZW0uXG4gICAgdHJhY2VzID0gdHJhY2VzID8/IFRyYWNlQ29sbGVjdGlvbi5lbXB0eSgpO1xuICAgIGlmICh0cmFjZSkge1xuICAgICAgdHJhY2VzLmFkZCh0cmFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGEgY29tbW9uIHRyYWNlIG9mIHRoZSBtZXNzYWdlIHdoZW4gbm8gc3BlY2lmaWMgdHJhY2Ugd2FzIHByb3ZpZGVkLlxuICAgICAgdHJhY2VzLmFkZChUcmFjZUNvbW1vbi5mcm9tKG1lc3NhZ2UsIERhdGUubm93KCkpKTtcbiAgICB9XG5cbiAgICBjb250ZXh0cyA9IGNvbnRleHRzID8/IENvbnRleHRDb2xsZWN0aW9uLmVtcHR5KCk7XG4gICAgcmV0dXJuIG5ldyBGYWlsdXJlKFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGNvZGUsXG4gICAgICB0cmFjZXMsXG4gICAgICBjb250ZXh0cyxcbiAgICAgIHByZXZpb3VzID8gcHJldmlvdXMgOiBudWxsLFxuICAgICk7XG4gIH1cblxuICBiaW5kKGZuOiAodmFsdWU6IG5ldmVyKSA9PiBSZXN1bHQ8bmV2ZXI+KTogUmVzdWx0PG5ldmVyPiB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBtYXAoZm46ICh2YWx1ZTogbmV2ZXIpID0+IG5ldmVyKTogUmVzdWx0PG5ldmVyPiB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBsaWZ0KHZhbHVlOiBuZXZlcik6IFJlc3VsdDxuZXZlcj4ge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdW53cmFwKCk6IG5ldmVyIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBvZiBGYWlsdXJlIGNhbiBub3QgYmUgdW53cmFwcGVkXCIpO1xuICB9XG5cbiAgZ2V0VHJhY2VzKCk6IFRyYWNlcyB7XG4gICAgcmV0dXJuIHRoaXMudHJhY2VzO1xuICB9XG5cbiAgd2l0aFRyYWNlKHRyYWNlOiBUcmFjZSk6IFJlc3VsdDxuZXZlcj4ge1xuICAgIHRoaXMudHJhY2VzLmFkZCh0cmFjZSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICB3aXRoQ29udGV4dChrZXk6IHN0cmluZywgY29udGV4dDogQ29udGV4dCk6IFJlc3VsdDxuZXZlcj4ge1xuICAgIHRoaXMuY29udGV4dHMuYWRkKGtleSwgY29udGV4dCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBnZXRDb250ZXh0KGtleTogc3RyaW5nKTogT3B0aW9uYWxSZXN1bHQ8Q29udGV4dD4ge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHRzLmdldChrZXkpO1xuICB9XG5cbiAgZ2V0Q29udGV4dHMoKTogQ29udGV4dHMge1xuICAgIHJldHVybiB0aGlzLmNvbnRleHRzO1xuICB9XG5cbiAgY2xlYXJDb250ZXh0KGtleTogc3RyaW5nKTogUmVzdWx0PG5ldmVyPiB7XG4gICAgdGhpcy5jb250ZXh0cy5yZW1vdmUoa2V5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNGYWlsdXJlPFQ+KG9iajogQXN5bmNSZXN1bHQ8VD4gfCBSZXN1bHQ8VD4pOiBvYmogaXMgRmFpbHVyZSB7XG4gIHJldHVybiBvYmogJiYgKG9iaiBhcyBGYWlsdXJlKVtGYWlsdXJlU3ltYm9sXSA9PT0gdHJ1ZTtcbn1cbiIsImltcG9ydCB7IEVpdGhlciB9IGZyb20gXCJAL21vbmFkL2VpdGhlclwiO1xuaW1wb3J0IHsgQXN5bmNSZXN1bHQsIE9wdGlvbmFsUmVzdWx0LCBSZXN1bHQgfSBmcm9tIFwiQC9tb25hZC9yZXN1bHRcIjtcbmltcG9ydCB7IENvbnRleHRzIH0gZnJvbSBcIkAvbW9uYWQvY29udGV4dC9jb250ZXh0c1wiO1xuaW1wb3J0IHsgVHJhY2VzIH0gZnJvbSBcIkAvbW9uYWQvdHJhY2UvdHJhY2VzXCI7XG5pbXBvcnQgeyBUcmFjZSB9IGZyb20gXCJAL21vbmFkL3RyYWNlL3RyYWNlXCI7XG5pbXBvcnQgeyBDb250ZXh0IH0gZnJvbSBcIkAvbW9uYWQvY29udGV4dC9jb250ZXh0XCI7XG5pbXBvcnQgeyBUcmFjZUNvbGxlY3Rpb24gfSBmcm9tIFwiQC9tb25hZC90cmFjZS90cmFjZS1jb2xsZWN0aW9uXCI7XG5pbXBvcnQgeyBDb250ZXh0Q29sbGVjdGlvbiB9IGZyb20gXCJAL21vbmFkL2NvbnRleHQvY29udGV4dC1jb2xsZWN0aW9uXCI7XG5pbXBvcnQgeyBGYWlsdXJlIH0gZnJvbSBcIkAvbW9uYWQvbW9uYWRzL2VpdGhlci9mYWlsdXJlXCI7XG5cbmNvbnN0IFN1Y2Nlc3NTeW1ib2wgPSBTeW1ib2woXCJKc01vbmFkU3VjY2Vzc1N5bWJvbFwiKTtcblxuZXhwb3J0IGNsYXNzIFN1Y2Nlc3M8VD4gaW1wbGVtZW50cyBFaXRoZXI8VD4ge1xuICBwcml2YXRlIHJlYWRvbmx5IHZhbHVlOiBUO1xuICBwcml2YXRlIHJlYWRvbmx5IHRyYWNlczogVHJhY2VzO1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbnRleHRzOiBDb250ZXh0cztcbiAgW1N1Y2Nlc3NTeW1ib2xdID0gdHJ1ZTtcblxuICBzdGF0aWMgW1N5bWJvbC5oYXNJbnN0YW5jZV0ob2JqOiBhbnkpOiBib29sZWFuIHtcbiAgICByZXR1cm4gaXNTdWNjZXNzKG9iaik7XG4gIH1cblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHZhbHVlOiBULCB0cmFjZXM6IFRyYWNlcywgY29udGV4dHM6IENvbnRleHRzKSB7XG4gICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgIHRoaXMudHJhY2VzID0gdHJhY2VzO1xuICAgIHRoaXMuY29udGV4dHMgPSBjb250ZXh0cztcbiAgfVxuXG4gIHN0YXRpYyBvZih2YWx1ZTogYW55LCB0cmFjZXM/OiBUcmFjZXMgfCBudWxsLCBjb250ZXh0cz86IENvbnRleHRzIHwgbnVsbCkge1xuICAgIHJldHVybiBuZXcgU3VjY2VzcyhcbiAgICAgIHZhbHVlLFxuICAgICAgdHJhY2VzID8/IFRyYWNlQ29sbGVjdGlvbi5lbXB0eSgpLFxuICAgICAgY29udGV4dHMgPz8gQ29udGV4dENvbGxlY3Rpb24uZW1wdHkoKSxcbiAgICApO1xuICB9XG5cbiAgYmluZChmbjogKHZhbHVlOiBUKSA9PiBSZXN1bHQ8VD4pOiBSZXN1bHQ8VD4ge1xuICAgIHJldHVybiBmbih0aGlzLnZhbHVlKTtcbiAgfVxuXG4gIGxpZnQodmFsdWU6IGFueSk6IFJlc3VsdDxUPiB7XG4gICAgcmV0dXJuIG5ldyBTdWNjZXNzKHZhbHVlLCB0aGlzLnRyYWNlcywgdGhpcy5jb250ZXh0cyk7XG4gIH1cblxuICBtYXAoZm46ICh2YWx1ZTogYW55KSA9PiBhbnkpOiBSZXN1bHQ8VD4ge1xuICAgIHJldHVybiBuZXcgU3VjY2Vzcyhmbih0aGlzLnZhbHVlKSwgdGhpcy50cmFjZXMsIHRoaXMuY29udGV4dHMpO1xuICB9XG5cbiAgdW53cmFwKCk6IFQge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9XG5cbiAgZ2V0VHJhY2VzKCk6IFRyYWNlcyB7XG4gICAgcmV0dXJuIHRoaXMudHJhY2VzO1xuICB9XG5cbiAgd2l0aFRyYWNlKHRyYWNlOiBUcmFjZSk6IFJlc3VsdDxUPiB7XG4gICAgdGhpcy50cmFjZXMuYWRkKHRyYWNlKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHdpdGhDb250ZXh0KGtleTogc3RyaW5nLCBjb250ZXh0OiBDb250ZXh0KTogUmVzdWx0PFQ+IHtcbiAgICB0aGlzLmNvbnRleHRzLmFkZChrZXksIGNvbnRleHQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZ2V0Q29udGV4dChrZXk6IHN0cmluZyk6IE9wdGlvbmFsUmVzdWx0PENvbnRleHQ+IHtcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0cy5nZXQoa2V5KTtcbiAgfVxuXG4gIGdldENvbnRleHRzKCk6IENvbnRleHRzIHtcbiAgICByZXR1cm4gdGhpcy5jb250ZXh0cztcbiAgfVxuXG4gIGNsZWFyQ29udGV4dChrZXk6IHN0cmluZyk6IFJlc3VsdDxUPiB7XG4gICAgdGhpcy5jb250ZXh0cy5yZW1vdmUoa2V5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTdWNjZXNzPFQ+KFxuICBvYmo6IEFzeW5jUmVzdWx0PFQ+IHwgUmVzdWx0PFQ+LFxuKTogb2JqIGlzIFN1Y2Nlc3M8VD4ge1xuICByZXR1cm4gb2JqICYmIChvYmogYXMgU3VjY2VzczxUPilbU3VjY2Vzc1N5bWJvbF0gPT09IHRydWU7XG59XG4iLCIvLyBTdGVwIDE6IENyZWF0ZSBhIHVuaXF1ZSBzeW1ib2wgdG8gdGFnIHRoZSBjbGFzc1xuaW1wb3J0IHsgQXN5bmNSZXN1bHQsIFJlc3VsdCB9IGZyb20gXCJAL21vbmFkL3Jlc3VsdFwiO1xuaW1wb3J0IHsgU3VjY2VzcyB9IGZyb20gXCJAL21vbmFkL21vbmFkcy9laXRoZXIvc3VjY2Vzc1wiO1xuXG5jb25zdCBBd2FpdGluZ1N5bWJvbCA9IFN5bWJvbChcIkpzTW9uYWRBd2FpdGluZ1N5bWJvbFwiKTtcblxuLy8gU3RlcCAyOiBEZWZpbmUgdGhlIEF3YWl0aW5nIGNsYXNzIGFuZCB0YWcgaXQgd2l0aCB0aGUgc3ltYm9sXG5leHBvcnQgaW50ZXJmYWNlIEF3YWl0aW5nSSB7fVxuXG5leHBvcnQgY2xhc3MgQXdhaXRpbmcgaW1wbGVtZW50cyBBd2FpdGluZ0kge1xuICAvLyBUYWdnaW5nIHRoZSBjbGFzcyB3aXRoIHRoZSBzeW1ib2xcbiAgW0F3YWl0aW5nU3ltYm9sXSA9IHRydWU7XG59XG5cbi8vIFJldHVybnMgJ1RydWUnIHdoZW4gb25lIHZhbHVlIGlzIGluc3RhbmNlIG9mIEF3YWl0aW5nLlxuZXhwb3J0IGZ1bmN0aW9uIGlzQXdhaXRpbmc8VD4ob2JqOiBBc3luY1Jlc3VsdDxUPik6IG9iaiBpcyBBd2FpdGluZyB7XG4gIHJldHVybiBvYmogJiYgKG9iaiBhcyBBd2FpdGluZylbQXdhaXRpbmdTeW1ib2xdID09PSB0cnVlO1xufVxuIiwiaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VSZWYgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IEFzeW5jUmVzdWx0IH0gZnJvbSBcIkAvbW9uYWQvcmVzdWx0XCI7XG5pbXBvcnQgeyBBd2FpdGluZyB9IGZyb20gXCJAL21vbmFkL2F3YWl0aW5nXCI7XG5pbXBvcnQgeyBTdWNjZXNzIH0gZnJvbSBcIkAvbW9uYWQvbW9uYWRzL2VpdGhlci9zdWNjZXNzXCI7XG5pbXBvcnQgeyBGYWlsdXJlIH0gZnJvbSBcIkAvbW9uYWQvbW9uYWRzL2VpdGhlci9mYWlsdXJlXCI7XG5pbXBvcnQgaXNFcXVhbCBmcm9tIFwiZmFzdC1kZWVwLWVxdWFsXCI7XG5cbnR5cGUgQ2FsbGJhY2tzPFQ+ID0ge1xuICBvblN1Y2Nlc3M/OiAodmFsdWU6IFQpID0+IHZvaWQ7XG4gIG9uRmFpbHVyZT86IChlcnJvcjogc3RyaW5nKSA9PiB2b2lkO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHVzZUVmZmVjdEFzeW5jUmVzdWx0PFQ+KFxuICByZXN1bHQ6IEFzeW5jUmVzdWx0PFQ+LFxuICB7IG9uU3VjY2Vzcywgb25GYWlsdXJlIH06IENhbGxiYWNrczxUPixcbik6IHZvaWQge1xuICBjb25zdCBwcmV2aW91c1JlZiA9IHVzZVJlZjxBc3luY1Jlc3VsdDxUPj4obmV3IEF3YWl0aW5nKCkpO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgcHJldmlvdXMgPSBwcmV2aW91c1JlZi5jdXJyZW50O1xuXG4gICAgY29uc3QgaGFzU3RhdHVzQ2hhbmdlZCA9ICgoKSA9PiB7XG4gICAgICBpZiAoXG4gICAgICAgIHByZXZpb3VzIGluc3RhbmNlb2YgQXdhaXRpbmcgJiZcbiAgICAgICAgKHJlc3VsdCBpbnN0YW5jZW9mIFN1Y2Nlc3MgfHwgcmVzdWx0IGluc3RhbmNlb2YgRmFpbHVyZSlcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChwcmV2aW91cyBpbnN0YW5jZW9mIFN1Y2Nlc3MgJiYgcmVzdWx0IGluc3RhbmNlb2YgRmFpbHVyZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChwcmV2aW91cyBpbnN0YW5jZW9mIEZhaWx1cmUgJiYgcmVzdWx0IGluc3RhbmNlb2YgU3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KSgpO1xuXG4gICAgY29uc3QgaGFzVmFsdWVDaGFuZ2VkID1cbiAgICAgIHJlc3VsdCBpbnN0YW5jZW9mIFN1Y2Nlc3MgJiZcbiAgICAgIHByZXZpb3VzIGluc3RhbmNlb2YgU3VjY2VzcyAmJlxuICAgICAgIWlzRXF1YWwocHJldmlvdXMudW53cmFwKCksIHJlc3VsdC51bndyYXAoKSk7XG5cbiAgICBpZiAoaGFzU3RhdHVzQ2hhbmdlZCB8fCBoYXNWYWx1ZUNoYW5nZWQpIHtcbiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBTdWNjZXNzICYmIG9uU3VjY2Vzcykge1xuICAgICAgICBvblN1Y2Nlc3MocmVzdWx0LnVud3JhcCgpKTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBGYWlsdXJlICYmIG9uRmFpbHVyZSkge1xuICAgICAgICBvbkZhaWx1cmUocmVzdWx0LnVud3JhcCgpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBwcmV2aW91c1JlZi5jdXJyZW50ID0gcmVzdWx0O1xuICB9LCBbcmVzdWx0LCBvblN1Y2Nlc3MsIG9uRmFpbHVyZV0pO1xufVxuXG5leHBvcnQgZGVmYXVsdCB1c2VFZmZlY3RBc3luY1Jlc3VsdDtcbiJdfQ==